<div class="highlight"><pre><span></span><span class="p">;</span><span class="s s-Atom">------------------------------------------------------------------------------</span><span class="p">;</span>
<span class="p">;</span>                                   <span class="nv">LICENSE</span>                                    <span class="p">;</span>
<span class="p">;</span><span class="s s-Atom">------------------------------------------------------------------------------</span><span class="p">;</span>
<span class="p">;</span>   <span class="nv">This</span> <span class="s s-Atom">file</span> <span class="o">is</span> <span class="s s-Atom">part</span> <span class="s s-Atom">of</span> <span class="s s-Atom">mitx_mathematics_programming_examples</span><span class="p">.</span>                <span class="p">;</span>
<span class="p">;</span>                                                                              <span class="p">;</span>
<span class="p">;</span>   <span class="s s-Atom">mitx_mathematics_programming_examples</span> <span class="o">is</span> <span class="s s-Atom">free</span> <span class="nn">software</span><span class="p">:</span> <span class="s s-Atom">you</span> <span class="s s-Atom">can</span>            <span class="p">;</span>
<span class="p">;</span>   <span class="s s-Atom">redistribute</span> <span class="s s-Atom">it</span> <span class="s s-Atom">and</span><span class="o">/</span><span class="s s-Atom">or</span> <span class="s s-Atom">modify</span> <span class="s s-Atom">it</span> <span class="s s-Atom">under</span> <span class="s s-Atom">the</span> <span class="s s-Atom">terms</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="nv">GNU</span> <span class="nv">General</span> <span class="nv">Public</span> <span class="p">;</span>
<span class="p">;</span>   <span class="nv">License</span> <span class="s s-Atom">as</span> <span class="s s-Atom">published</span> <span class="s s-Atom">by</span> <span class="s s-Atom">the</span> <span class="nv">Free</span> <span class="nv">Software</span> <span class="nv">Foundation</span><span class="p">,</span> <span class="s s-Atom">either</span> <span class="s s-Atom">version</span> <span class="mi">3</span> <span class="s s-Atom">of</span>  <span class="p">;</span>
<span class="p">;</span>   <span class="s s-Atom">the</span> <span class="nv">License</span><span class="p">,</span> <span class="nf">or</span> <span class="p">(</span><span class="s s-Atom">at</span> <span class="s s-Atom">your</span> <span class="s s-Atom">option</span><span class="p">)</span> <span class="s s-Atom">any</span> <span class="s s-Atom">later</span> <span class="s s-Atom">version</span><span class="p">.</span>                        <span class="p">;</span>
<span class="p">;</span>                                                                              <span class="p">;</span>
<span class="p">;</span>   <span class="s s-Atom">mitx_mathematics_programming_examples</span> <span class="o">is</span> <span class="s s-Atom">distributed</span> <span class="s s-Atom">in</span> <span class="s s-Atom">the</span> <span class="s s-Atom">hope</span> <span class="s s-Atom">that</span> <span class="s s-Atom">it</span>   <span class="p">;</span>
<span class="p">;</span>   <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">useful</span> <span class="s s-Atom">but</span> <span class="nv">WITHOUT</span> <span class="nv">ANY</span> <span class="nv">WARRANTY</span><span class="p">;</span> <span class="s s-Atom">without</span> <span class="s s-Atom">even</span> <span class="s s-Atom">the</span> <span class="s s-Atom">implied</span> <span class="s s-Atom">warranty</span> <span class="p">;</span>
<span class="p">;</span>   <span class="s s-Atom">of</span> <span class="nv">MERCHANTABILITY</span> <span class="s s-Atom">or</span> <span class="nv">FITNESS</span> <span class="nv">FOR</span> <span class="nv">A</span> <span class="nv">PARTICULAR</span> <span class="nv">PURPOSE</span><span class="p">.</span>  <span class="nv">See</span> <span class="s s-Atom">the</span>           <span class="p">;</span>
<span class="p">;</span>   <span class="nv">GNU</span> <span class="nv">General</span> <span class="nv">Public</span> <span class="nv">License</span> <span class="s s-Atom">for</span> <span class="s s-Atom">more</span> <span class="s s-Atom">details</span><span class="p">.</span>                               <span class="p">;</span>
<span class="p">;</span>                                                                              <span class="p">;</span>
<span class="p">;</span>   <span class="nv">You</span> <span class="s s-Atom">should</span> <span class="s s-Atom">have</span> <span class="s s-Atom">received</span> <span class="s s-Atom">a</span> <span class="s s-Atom">copy</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="nv">GNU</span> <span class="nv">General</span> <span class="nv">Public</span> <span class="nv">License</span>          <span class="p">;</span>
<span class="p">;</span>   <span class="s s-Atom">along</span> <span class="s s-Atom">with</span> <span class="s s-Atom">mitx_mathematics_programming_examples</span><span class="p">.</span>  <span class="nv">If</span> <span class="o">not</span><span class="p">,</span> <span class="s s-Atom">see</span>             <span class="p">;</span>
<span class="p">;</span>   <span class="o">&lt;</span><span class="nn">https</span><span class="p">:</span><span class="o">//</span><span class="s s-Atom">www</span><span class="p">.</span><span class="s s-Atom">gnu</span><span class="p">.</span><span class="s s-Atom">org</span><span class="o">/</span><span class="s s-Atom">licenses/&gt;.</span>                                           <span class="p">;</span>
<span class="p">;</span><span class="s s-Atom">------------------------------------------------------------------------------</span><span class="p">;</span>
<span class="p">;</span>   <span class="nv">Purpose</span><span class="s s-Atom">:</span>                                                                   <span class="p">;</span>
<span class="p">;</span>       <span class="nv">Calculates</span> <span class="s s-Atom">roots</span> <span class="s s-Atom">using</span> <span class="nv">Steffensen</span><span class="s s-Atom">&#39;s method.                            ;</span>
<span class="s s-Atom">;------------------------------------------------------------------------------;</span>
<span class="s s-Atom">;   Author: Ryan Maguire                                                       ;</span>
<span class="s s-Atom">;   Date:   2025/05/22                                                         ;</span>
<span class="s s-Atom">;------------------------------------------------------------------------------;</span>
<span class="s s-Atom">FUNCTION STEFFENSEN, F, X</span>

<span class="s s-Atom">    ; Tells the compiler that integers should be 32 bits, not 16.</span>
<span class="s s-Atom">    COMPILE_OPT IDL2</span>

<span class="s s-Atom">    ; Error checking code.</span>
<span class="s s-Atom">    ON_ERROR, 2</span>

<span class="s s-Atom">    ; Steffensen&#39;s</span> <span class="s s-Atom">method</span> <span class="o">is</span> <span class="s s-Atom">iterative</span><span class="p">.</span> <span class="nv">The</span> <span class="s s-Atom">convergence</span> <span class="o">is</span> <span class="s s-Atom">quadratic</span><span class="p">,</span> <span class="s s-Atom">meaning</span>
    <span class="p">;</span> <span class="s s-Atom">the</span> <span class="s s-Atom">number</span> <span class="s s-Atom">of</span> <span class="s s-Atom">accurate</span> <span class="s s-Atom">decimals</span> <span class="s s-Atom">doubles</span> <span class="s s-Atom">with</span> <span class="s s-Atom">each</span> <span class="s s-Atom">iteration</span><span class="p">.</span> <span class="nv">Because</span> <span class="s s-Atom">of</span>
    <span class="p">;</span> <span class="s s-Atom">this</span> <span class="s s-Atom">we</span> <span class="s s-Atom">can</span> <span class="s s-Atom">halt</span> <span class="s s-Atom">the</span> <span class="s s-Atom">algorithm</span> <span class="s s-Atom">after</span> <span class="s s-Atom">a</span> <span class="s s-Atom">few</span> <span class="s s-Atom">steps</span><span class="p">.</span>
    <span class="nv">MAXIMUM_NUMBER_OF_ITERATIONS</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="p">;</span> <span class="nv">Maximum</span> <span class="s s-Atom">allowed</span> <span class="s s-Atom">error</span><span class="p">.</span> <span class="nv">This</span> <span class="o">is</span> <span class="mi">4</span><span class="s s-Atom">x</span> <span class="s s-Atom">double</span> <span class="s s-Atom">precision</span> <span class="s s-Atom">epsilon</span><span class="p">.</span>
    <span class="nv">EPSILON</span> <span class="o">=</span> <span class="mf">8.881784197001252E-16</span>

    <span class="p">;</span> <span class="nv">Variable</span> <span class="s s-Atom">used</span> <span class="s s-Atom">for</span> <span class="nv">Steffensen</span><span class="s s-Atom">&#39;s approximation. We will iteratively update</span>
<span class="s s-Atom">    ; this value with better approximations using Steffensen&#39;s</span> <span class="s s-Atom">method</span><span class="p">.</span>
    <span class="nv">XN</span> <span class="o">=</span> <span class="nv">X</span>

    <span class="p">;</span> <span class="nv">Iteratively</span> <span class="s s-Atom">perform</span> <span class="nv">Steffensen</span><span class="s s-Atom">&#39;s method.</span>
<span class="s s-Atom">    FOR ITERS = 1, MAXIMUM_NUMBER_OF_ITERATIONS DO BEGIN</span>

<span class="s s-Atom">        ; Steffensen&#39;s</span> <span class="s s-Atom">method</span> <span class="s s-Atom">needs</span> <span class="s s-Atom">the</span> <span class="s s-Atom">evaluations</span> <span class="nf">f</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">)</span> <span class="s s-Atom">and</span> <span class="nf">f</span><span class="p">(</span><span class="s s-Atom">x</span> <span class="o">+</span> <span class="nf">f</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">)),</span>
        <span class="p">;</span> <span class="s s-Atom">in</span> <span class="s s-Atom">particular</span> <span class="s s-Atom">the</span> <span class="s s-Atom">denominator</span> <span class="o">is</span> <span class="nf">f</span><span class="p">(</span><span class="s s-Atom">x</span> <span class="o">+</span> <span class="nf">f</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">))</span> <span class="o">/</span> <span class="nf">f</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span> <span class="nv">Compute</span><span class="p">.</span>
        <span class="nv">F_XN</span> <span class="o">=</span> <span class="nv">CALL_FUNCTION</span><span class="p">(</span><span class="nv">F</span><span class="p">,</span> <span class="nv">XN</span><span class="p">)</span>
        <span class="nv">G_XN</span> <span class="o">=</span> <span class="nv">CALL_FUNCTION</span><span class="p">(</span><span class="nv">F</span><span class="p">,</span> <span class="nv">XN</span> <span class="o">+</span> <span class="nv">F_XN</span><span class="p">)</span> <span class="o">/</span> <span class="nv">F_XN</span> <span class="o">-</span> <span class="mf">1.0</span>

        <span class="p">;</span> <span class="nv">Like</span> <span class="nv">Newton</span><span class="s s-Atom">&#39;s method, the new point is obtained by subtracting</span>
<span class="s s-Atom">        ; the ratio. g(x) = f(x + f(x)) / f(x) - 1 acts as the derivative</span>
<span class="s s-Atom">        ; of f, but we do not explicitly need to calculate f&#39;</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">).</span>
        <span class="nv">XN</span> <span class="o">=</span> <span class="nv">XN</span> <span class="o">-</span> <span class="nv">F_XN</span> <span class="o">/</span> <span class="nv">G_XN</span>

        <span class="p">;</span> <span class="nv">If</span> <span class="nf">f</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">)</span> <span class="o">is</span> <span class="s s-Atom">very</span> <span class="s s-Atom">small</span><span class="p">,</span> <span class="s s-Atom">we</span> <span class="s s-Atom">are</span> <span class="s s-Atom">close</span> <span class="s s-Atom">to</span> <span class="s s-Atom">a</span> <span class="s s-Atom">root</span> <span class="s s-Atom">and</span> <span class="s s-Atom">can</span> <span class="s s-Atom">break</span> <span class="s s-Atom">out</span>
        <span class="p">;</span> <span class="s s-Atom">of</span> <span class="s s-Atom">this</span> <span class="s s-Atom">for</span> <span class="s s-Atom">loop</span><span class="p">.</span> <span class="nv">Check</span> <span class="s s-Atom">for</span> <span class="s s-Atom">this</span><span class="p">.</span>
        <span class="nv">IF</span> <span class="p">(</span><span class="nv">ABS</span><span class="p">(</span><span class="nv">F_XN</span><span class="p">)</span> <span class="nv">LE</span> <span class="nv">EPSILON</span><span class="p">)</span> <span class="nv">THEN</span> <span class="nv">BREAK</span>

    <span class="nv">END</span>

    <span class="p">;</span> <span class="nv">Like</span> <span class="nv">Newton</span><span class="s s-Atom">&#39;s method, and like Heron&#39;s</span> <span class="s s-Atom">method</span><span class="p">,</span> <span class="s s-Atom">the</span> <span class="s s-Atom">convergence</span> <span class="o">is</span>
    <span class="p">;</span> <span class="s s-Atom">quadratic</span><span class="p">.</span> <span class="nv">After</span> <span class="s s-Atom">a</span> <span class="s s-Atom">few</span> <span class="s s-Atom">iterations</span> <span class="s s-Atom">we</span> <span class="s s-Atom">will</span> <span class="s s-Atom">be</span> <span class="s s-Atom">very</span> <span class="s s-Atom">to</span> <span class="s s-Atom">close</span> <span class="s s-Atom">a</span> <span class="s s-Atom">root</span><span class="p">.</span>
    <span class="nv">RETURN</span><span class="p">,</span> <span class="nv">XN</span>

<span class="nv">END</span>

<span class="p">;</span> <span class="nf">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">is</span> <span class="s s-Atom">the</span> <span class="s s-Atom">root</span> <span class="s s-Atom">of</span> <span class="s s-Atom">the</span> <span class="s s-Atom">function</span> <span class="mi">2</span> <span class="o">-</span> <span class="s s-Atom">x^</span><span class="mf">2.</span> <span class="nv">Define</span> <span class="s s-Atom">this</span><span class="p">.</span>
<span class="nv">FUNCTION</span> <span class="nv">FUNC</span><span class="p">,</span> <span class="nv">X</span>

    <span class="nv">COMPILE_OPT</span> <span class="nv">IDL2</span>
    <span class="nv">RETURN</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="nv">X</span><span class="o">*</span><span class="nv">X</span>

<span class="nv">END</span>

<span class="p">;</span> <span class="nv">Program</span> <span class="s s-Atom">for</span> <span class="s s-Atom">testing</span> <span class="s s-Atom">our</span> <span class="s s-Atom">implementation</span> <span class="s s-Atom">of</span> <span class="nv">Steffensen</span><span class="s s-Atom">&#39;s method.</span>
<span class="s s-Atom">PRO MAIN</span>

<span class="s s-Atom">    COMPILE_OPT IDL2</span>

<span class="s s-Atom">    ; The input for the method. We&#39;ll</span> <span class="s s-Atom">compute</span> <span class="nf">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span>
    <span class="nv">X</span> <span class="o">=</span> <span class="nv">DOUBLE</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="p">;</span> <span class="nv">Run</span> <span class="s s-Atom">the</span> <span class="s s-Atom">routine</span><span class="p">,</span> <span class="s s-Atom">computing</span> <span class="nf">sqrt</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">),</span> <span class="s s-Atom">and</span> <span class="s s-Atom">print</span> <span class="s s-Atom">the</span> <span class="s s-Atom">result</span><span class="p">.</span>
    <span class="nv">SQRT_2</span> <span class="o">=</span> <span class="nv">STEFFENSEN</span><span class="p">(</span><span class="s2">&quot;FUNC&quot;</span><span class="p">,</span> <span class="nv">X</span><span class="p">)</span>
    <span class="nv">PRINT</span><span class="p">,</span> <span class="nv">X</span><span class="p">,</span> <span class="nv">SQRT_2</span><span class="p">,</span> <span class="nv">FORMAT</span> <span class="o">=</span> <span class="s s-Atom">&#39;SQRT(%3.1f) = %18.16f&#39;</span>

<span class="nv">END</span>
</pre></div>
