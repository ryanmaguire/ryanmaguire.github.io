<div class="highlight"><pre><span></span><span class="cm">(******************************************************************************</span>
<span class="cm"> *                                  LICENSE                                   *</span>
<span class="cm"> ******************************************************************************</span>
<span class="cm"> *  This file is part of mitx_mathematics_programming_examples.               *</span>
<span class="cm"> *                                                                            *</span>
<span class="cm"> *  mitx_mathematics_programming_examples is free software: you can           *</span>
<span class="cm"> *  redistribute it and/or modify it under the terms of the GNU General Public*</span>
<span class="cm"> *  License as published by the Free Software Foundation, either version 3 of *</span>
<span class="cm"> *  the License, or (at your option) any later version.                       *</span>
<span class="cm"> *                                                                            *</span>
<span class="cm"> *  mitx_mathematics_programming_examples is distributed in the hope that it  *</span>
<span class="cm"> *  will be useful but WITHOUT ANY WARRANTY; without even the implied warranty*</span>
<span class="cm"> *  of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the          *</span>
<span class="cm"> *  GNU General Public License for more details.                              *</span>
<span class="cm"> *                                                                            *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License         *</span>
<span class="cm"> *  along with mitx_mathematics_programming_examples.  If not, see            *</span>
<span class="cm"> *  &lt;https://www.gnu.org/licenses/&gt;.                                          *</span>
<span class="cm"> ******************************************************************************</span>
<span class="cm"> *  Purpose:                                                                  *</span>
<span class="cm"> *      Computes roots using Steffensen&#39;s method.                             *</span>
<span class="cm"> ******************************************************************************</span>
<span class="cm"> *  Author: Ryan Maguire                                                      *</span>
<span class="cm"> *  Date:   2025/05/25                                                        *</span>
<span class="cm"> ******************************************************************************)</span>
<span class="k">PROGRAM</span><span class="w"> </span><span class="n">Steffensen</span><span class="o">;</span>

<span class="cm">(*  We define two constants: The allowed tolerance (or epsilon value),        *</span>
<span class="cm"> *  and the maximum number of iterations we allow for Steffensen&#39;s method.    *)</span>
<span class="k">CONST</span>

<span class="w">    </span><span class="cm">(*  Steffensen&#39;s method is iterative and converges very quickly.          *</span>
<span class="cm">     *  Because of this we may exit the function after a few iterations.      *)</span>
<span class="w">    </span><span class="n">MaximumNumberOfIterations</span><span class="o">:</span><span class="w"> </span><span class="kt">Integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="o">;</span>

<span class="w">    </span><span class="cm">(*  The maximum allowed error. This is 4x double precision epsilon.       *)</span>
<span class="w">    </span><span class="n">Epsilon</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.881784197001252E-16</span><span class="o">;</span>

<span class="w">    </span><span class="cm">(*  2 is close enough to sqrt(2) for Steffensen&#39;s method to work.         *)</span>
<span class="w">    </span><span class="n">Guess</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="o">;</span>

<span class="cm">(*  Create an alias for real functions f: R -&gt; R. This makes the syntax of    *</span>
<span class="cm"> *  the parameters for SteffensensMethod function a little more readable.     *)</span>
<span class="k">TYPE</span>
<span class="w">    </span><span class="n">RealFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Function</span><span class="p">(</span><span class="k">Const</span><span class="w"> </span><span class="n">X</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="o">;</span>

<span class="cm">(*  The program has one variable, sqrt(2) computed via Steffensen&#39;s method.   *)</span>
<span class="k">VAR</span>
<span class="w">    </span><span class="n">Sqrt2</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="o">;</span>

<span class="cm">(*  f(x) = 2 - x^2 has sqrt(2) as a root. This is the input function.         *)</span>
<span class="k">Function</span><span class="w"> </span><span class="nf">Func</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">X</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="o">;</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="n">Func</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="o">;</span>
<span class="k">END</span><span class="o">;</span>

<span class="cm">(******************************************************************************</span>
<span class="cm"> *  Function:                                                                 *</span>
<span class="cm"> *      SteffensensMethod                                                     *</span>
<span class="cm"> *  Purpose:                                                                  *</span>
<span class="cm"> *      Computes roots using Steffensen&#39;s method.                             *</span>
<span class="cm"> *   Arguments:                                                               *</span>
<span class="cm"> *      F (RealFunc):                                                         *</span>
<span class="cm"> *          A continuous function f: R -&gt; R.                                  *</span>
<span class="cm"> *      X (Real):                                                             *</span>
<span class="cm"> *          The initial guess point for Steffensen&#39;s method.                  *</span>
<span class="cm"> *   OUTPUT:                                                                  *</span>
<span class="cm"> *       Root (Real):                                                         *</span>
<span class="cm"> *           A root for F near X.                                             *</span>
<span class="cm"> ******************************************************************************)</span>
<span class="k">Function</span><span class="w"> </span><span class="nf">SteffensensMethod</span><span class="p">(</span><span class="k">Const</span><span class="w"> </span><span class="n">F</span><span class="o">:</span><span class="w"> </span><span class="n">RealFunc</span><span class="o">;</span><span class="w"> </span><span class="k">Const</span><span class="w"> </span><span class="n">X</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="o">;</span>

<span class="k">VAR</span>
<span class="w">    </span><span class="cm">(*  Steffensen&#39;s method is iterative, like Newton&#39;s method, but avoids    *</span>
<span class="cm">     *  explicit use of the derivative of F. Instead it uses the function     *</span>
<span class="cm">     *  G(x) = F(x + F(x)) / F(X) - 1, which acts like F&#39;(x). Provide a       *</span>
<span class="cm">     *  variable for each of these expressions, Xn is the nth approximation.  *)</span>
<span class="w">    </span><span class="n">Xn</span><span class="o">,</span><span class="w"> </span><span class="n">Fxn</span><span class="o">,</span><span class="w"> </span><span class="n">Gxn</span><span class="o">:</span><span class="w"> </span><span class="kt">Real</span><span class="o">;</span>

<span class="w">    </span><span class="cm">(*  Dummy variable for tracking how many iterations we&#39;ve performed.      *)</span>
<span class="w">    </span><span class="n">Iters</span><span class="o">:</span><span class="w"> </span><span class="kt">Integer</span><span class="o">;</span>

<span class="k">BEGIN</span>

<span class="w">    </span><span class="cm">(*  Steffensen&#39;s method starts the iterative process at the guess point.  *)</span>
<span class="w">    </span><span class="n">Xn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">X</span><span class="o">;</span>

<span class="w">    </span><span class="cm">(*  Iteratively perform Steffensen&#39;s method.                              *)</span>
<span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="n">Iters</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">MaximumNumberOfIterations</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DO</span>
<span class="w">    </span><span class="k">BEGIN</span>

<span class="w">        </span><span class="cm">(*  Steffensen&#39;s method needs the evaluations f(x) and f(x + f(x)),   *</span>
<span class="cm">         *  in particular the denominator is f(x + f(x)) / f(x) - 1. Compute. *)</span>
<span class="w">        </span><span class="n">Fxn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">Xn</span><span class="p">)</span><span class="o">;</span>
<span class="w">        </span><span class="n">Gxn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">Xn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Fxn</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Fxn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="o">;</span>

<span class="w">        </span><span class="cm">(*  Like Newton&#39;s method, the new point is obtained by subtracting    *</span>
<span class="cm">         *  the ratio. g(x) = f(x + f(x)) / f(x) - 1 acts as the derivative   *</span>
<span class="cm">         *  of f, but we do not explicitly need to calculate f&#39;(x).           *)</span>
<span class="w">        </span><span class="n">Xn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">Xn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Fxn</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Gxn</span><span class="o">;</span>

<span class="w">        </span><span class="cm">(*  If f(x) is very small, we are close to a root and can break out   *</span>
<span class="cm">         *  of this for loop. Check for this.                                 *)</span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">Fxn</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Epsilon</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">BREAK</span><span class="o">;</span>

<span class="w">    </span><span class="k">END</span><span class="o">;</span>

<span class="w">    </span><span class="cm">(*  Like Newton&#39;s method, and like Heron&#39;s method, the convergence is     *</span>
<span class="cm">     *  quadratic. After a few iterations we will be very to close a root.    *)</span>
<span class="w">    </span><span class="n">SteffensensMethod</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">Xn</span><span class="o">;</span>
<span class="k">END</span><span class="o">;</span>

<span class="cm">(*  Program for testing our implementation of Steffensen&#39;s method.            *)</span>
<span class="k">BEGIN</span>

<span class="w">    </span><span class="cm">(*  Compute sqrt(2) using Steffensen&#39;s method and print the result.       *)</span>
<span class="w">    </span><span class="n">Sqrt2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">SteffensensMethod</span><span class="p">(</span><span class="o">@</span><span class="n">Func</span><span class="o">,</span><span class="w"> </span><span class="n">Guess</span><span class="p">)</span><span class="o">;</span>
<span class="w">    </span><span class="nb">WriteLn</span><span class="p">(</span><span class="s">&#39;sqrt(2) = &#39;</span><span class="o">,</span><span class="w"> </span><span class="n">Sqrt2</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span><span class="mi">16</span><span class="p">)</span><span class="o">;</span>

<span class="k">END</span><span class="o">.</span>
</pre></div>
