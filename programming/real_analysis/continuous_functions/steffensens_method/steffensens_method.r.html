<div class="highlight"><pre><span></span><span class="c">################################################################################</span>
<span class="c">#                                   LICENSE                                    #</span>
<span class="c">################################################################################</span>
<span class="c">#   This file is part of mitx_mathematics_programming_examples.                #</span>
<span class="c">#                                                                              #</span>
<span class="c">#   mitx_mathematics_programming_examples is free software: you can            #</span>
<span class="c">#   redistribute it and/or modify it under the terms of the GNU General Public #</span>
<span class="c">#   License as published by the Free Software Foundation, either version 3 of  #</span>
<span class="c">#   the License, or (at your option) any later version.                        #</span>
<span class="c">#                                                                              #</span>
<span class="c">#   mitx_mathematics_programming_examples is distributed in the hope that it   #</span>
<span class="c">#   will be useful, but WITHOUT ANY WARRANTY; without even the implied         #</span>
<span class="c">#   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  #</span>
<span class="c">#   GNU General Public License for more details.                               #</span>
<span class="c">#                                                                              #</span>
<span class="c">#   You should have received a copy of the GNU General Public License          #</span>
<span class="c">#   along with mitx_mathematics_programming_examples.  If not, see             #</span>
<span class="c">#   &lt;https://www.gnu.org/licenses/&gt;.                                           #</span>
<span class="c">################################################################################</span>
<span class="c">#   Purpose:                                                                   #</span>
<span class="c">#       Calculates roots of a function using Steffensen&#39;s method.              #</span>
<span class="c">################################################################################</span>
<span class="c">#   Author:     Ryan Maguire                                                   #</span>
<span class="c">#   Date:       May 25, 2025.                                                  #</span>
<span class="c">################################################################################</span>

<span class="c"># Computes the root of a function using Steffensen&#39;s method.</span>
<span class="c">steffensen &lt;- function(f, x) {</span>

<span class="c">    # Steffensen&#39;s method is iterative and converges very quickly.</span>
<span class="c">    # Because of this we may exit the function after a few iterations.</span>
<span class="c">    maximum_number_of_iterations &lt;- 64</span>

<span class="c">    # The maximum allowed error. This is 4x double precision epsilon.</span>
<span class="c">    epsilon &lt;- 8.881784197001252E-16</span>

<span class="c">    # The method starts at the provided guess point and updates iteratively.</span>
<span class="c">    xn &lt;- x</span>

<span class="c">    # Iteratively apply Steffensen&#39;s method to find the root.</span>
<span class="c">    for (iters in 1:maximum_number_of_iterations) {</span>

<span class="c">        # Steffensen&#39;s method needs the evaluations f(x) and f(x + f(x)),</span>
<span class="c">        # in particular the denominator is f(x + f(x)) / f(x) - 1. Compute.</span>
<span class="c">        f_xn &lt;- f(xn)</span>
<span class="c">        g_xn &lt;- f(xn + f_xn) / f_xn - 1.0</span>

<span class="c">        # Like Newton&#39;s method, the new point is obtained by subtracting</span>
<span class="c">        # the ratio. g(x) = f(x + f(x)) / f(x) - 1 acts as the derivative</span>
<span class="c">        # of f, but we do not explicitly need to calculate f&#39;(x).</span>
<span class="c">        xn &lt;- xn - f_xn / g_xn</span>

<span class="c">        # If f(x) is very small, we are close to a root and can break out</span>
<span class="c">        # of this for loop. Check for this.</span>
<span class="c">        if (abs(f_xn) &lt; epsilon) {</span>
<span class="c">            break</span>
<span class="c">        }</span>
<span class="c">    }</span>

<span class="c">    # Like Newton&#39;s method, and like Heron&#39;s method, the convergence is</span>
<span class="c">    # quadratic. After a few iterations we will be very to close a root.</span>
<span class="c">    return(xn)</span>
<span class="c">}</span>
<span class="c"># End of steffensen.</span>

<span class="c"># sqrt(2) is a root to the function f(x) = 2 - x^2.</span>
<span class="c">f &lt;- function(x) {</span>
<span class="c">    return(2.0 - x*x)</span>
<span class="c">}</span>

<span class="c"># The initial guess point for Steffensen&#39;s method.</span>
<span class="c">x &lt;- 2.0</span>

<span class="c"># Calculate the square root and print it to the screen. If we have</span>
<span class="c"># written things correctly, we should get 1.414..., which is sqrt(2).</span>
<span class="c">sqrt_x &lt;- steffensen(f, x)</span>
<span class="c">output = sprintf(&quot;sqrt(2) = %.16f&quot;, sqrt_x)</span>
<span class="c">message(output)</span>
</pre></div>
