<div class="highlight"><pre><span></span><span class="c">################################################################################</span>
<span class="c">#                                   LICENSE                                    #</span>
<span class="c">################################################################################</span>
<span class="c">#   This file is part of mitx_mathematics_programming_examples.                #</span>
<span class="c">#                                                                              #</span>
<span class="c">#   mitx_mathematics_programming_examples is free software: you can            #</span>
<span class="c">#   redistribute it and/or modify it under the terms of the GNU General Public #</span>
<span class="c">#   License as published by the Free Software Foundation, either version 3 of  #</span>
<span class="c">#   the License, or (at your option) any later version.                        #</span>
<span class="c">#                                                                              #</span>
<span class="c">#   mitx_mathematics_programming_examples is distributed in the hope that it   #</span>
<span class="c">#   will be useful, but WITHOUT ANY WARRANTY; without even the implied         #</span>
<span class="c">#   warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  #</span>
<span class="c">#   GNU General Public License for more details.                               #</span>
<span class="c">#                                                                              #</span>
<span class="c">#   You should have received a copy of the GNU General Public License          #</span>
<span class="c">#   along with mitx_mathematics_programming_examples.  If not, see             #</span>
<span class="c">#   &lt;https://www.gnu.org/licenses/&gt;.                                           #</span>
<span class="c">################################################################################</span>
<span class="c">#   Purpose:                                                                   #</span>
<span class="c">#       Calculates roots of a function using Steffensen&#39;s method.              #</span>
<span class="c">################################################################################</span>
<span class="c">#   Author:     Ryan Maguire                                                   #</span>
<span class="c">#   Date:       May 25, 2025.                                                  #</span>
<span class="c">################################################################################</span>

<span class="c">################################################################################</span>
<span class="c">#   Function:                                                                  #</span>
<span class="c">#       steffensen                                                             #</span>
<span class="c">#   Purpose:                                                                   #</span>
<span class="c">#       Computes the root of a function f: R -&gt; R.                             #</span>
<span class="c">#   Arguments:                                                                 #</span>
<span class="c">#       f (function):                                                          #</span>
<span class="c">#           A function f: R -&gt; R. The root of f is computed.                   #</span>
<span class="c">#       x (float):                                                             #</span>
<span class="c">#           The guess point for the root of f.                                 #</span>
<span class="c">#   Output:                                                                    #</span>
<span class="c">#       root (float):                                                          #</span>
<span class="c">#           A root of the function f near x.                                   #</span>
<span class="c">################################################################################</span>
<span class="k">function</span><span class="w"> </span><span class="n">steffensen</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>

<span class="w">    </span><span class="c"># Steffensen&#39;s method is iterative. The convergence is quadratic, meaning</span>
<span class="w">    </span><span class="c"># the number of accurate decimals doubles with each iteration. Because of</span>
<span class="w">    </span><span class="c"># this we can halt the algorithm after a few steps.</span>
<span class="w">    </span><span class="n">maximum_number_of_iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span>

<span class="w">    </span><span class="c"># Maximum allowed error. This is 4x double precision epsilon.</span>
<span class="w">    </span><span class="n">epsilon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.881784197001252E-16</span>

<span class="w">    </span><span class="c"># Steffensen&#39;s method starts the process at the guess point.</span>
<span class="w">    </span><span class="n">xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>

<span class="w">    </span><span class="c"># Iteratively perform Steffensen&#39;s method.</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">maximum_number_of_iterations</span>

<span class="w">        </span><span class="c"># Steffensen&#39;s method needs the evaluations f(x) and f(x + f(x)),</span>
<span class="w">        </span><span class="c"># in particular the denominator is f(x + f(x)) / f(x) - 1.</span>
<span class="w">        </span><span class="n">f_xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span>
<span class="w">        </span><span class="n">g_xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">xn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f_xn</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f_xn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span>

<span class="w">        </span><span class="c"># Like Newton&#39;s method the new point is obtained by subtracting</span>
<span class="w">        </span><span class="c"># the ratio. g(x) = f(x + f(x))/f(x) - 1 acts as the derivative</span>
<span class="w">        </span><span class="c"># of f, but we do not explicitly need to calculate f&#39;(x).</span>
<span class="w">        </span><span class="n">xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f_xn</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">g_xn</span>

<span class="w">        </span><span class="c"># If f(x) is very small, we are close to a root and can break</span>
<span class="w">        </span><span class="c"># out of this for loop. Check for this.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">f_xn</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">epsilon</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="c"># Like Newton&#39;s method, and like Heron&#39;s method, the convergence is</span>
<span class="w">    </span><span class="c"># quadratic. After a few iterations we will be very to close a root.</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">xn</span>
<span class="k">end</span>

<span class="c"># Input function for Steffensen&#39;s method.</span>
<span class="k">function</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Computes f(x) = 2 - x^2. sqrt(2) is a root of this, we can compute</span>
<span class="s">        this value by applying Steffensen&#39;s method to this function.</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">x</span>
<span class="k">end</span>

<span class="c"># 2 is close enough to sqrt(2) for Steffensen&#39;s method to work.</span>
<span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span>

<span class="c"># Compute sqrt(2) using Steffensen&#39;s method and print the result.</span>
<span class="n">sqrt_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">steffensen</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;sqrt(2) = &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sqrt_2</span><span class="p">)</span>
</pre></div>
